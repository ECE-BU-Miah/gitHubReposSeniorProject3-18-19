%======================================================================
\chapter{Numerical Simulations}
%\chapter{MATLAB Simulations}
\label{ch: Chapter4}
%======================================================================
This chapter discusses the simulation results for the three control algorithms.  These simulations are for the LQR P type LQR PI type, and LQG PI type controllers.
%----------------------------------------------------------------------
\section{LQR (P controller)}
%----------------------------------------------------------------------
Using MATLAB, we created a program, as seen in \ref{ch:codeLQRsim}, that calculates LQR for our helicopter and then uses differential equations to simulate the trajectory. 
\begin{figure}[!htbp]
    \centering
    \subfigure[][]{
    %\missingfigure{Insert figure.}
    \includegraphics[width=.46\textwidth,keepaspectratio=true]{figs/matlab/LQR/P_Simulation/LQR_Pos_Con.eps}
    \label{fig:LQR_Pos_Con}
    }
    \subfigure[][]{
    %\missingfigure{Insert figure.}
    \includegraphics[width=.46\textwidth,keepaspectratio=true]{figs/matlab/LQR/P_Simulation/LQR_Error_Con.eps}
    \label{fig:LQR_Error_Con}
    }
    \subfigure[][]{
    %\missingfigure{Insert figure.}
    \includegraphics[width=.46\textwidth,keepaspectratio=true]{figs/matlab/LQR/P_Simulation/LQR_Volt_Con.eps}
    \label{fig:LQR_Volt_Con}
    }
    \caption{Simulations for proportional gain calculated by LQR.}
\end{figure}
Figure~\ref{fig:LQR_Pos_Con} represents the simulated position of the helicopter, Figure~\ref{fig:LQR_Error_Con}, illustrates the difference between the actual and desired configurations, and Figure~\ref{fig:LQR_Volt_Con} show the simulated voltage to the DC motors.  Suprisingly, the error is very small yet not zero which is attributed to a high gain.

%----------------------------------------------------------------------
\section{LQR (PI controller)}
%----------------------------------------------------------------------
Unlike the P controller, we created a Simulink model insead of using differential equations.  To do this, we had to create a block that represented our plant and create feedback for the system as seen in Figure~\ref{fig:LQR_Sim_Block_Diagram}.  
%\todo[inline]{Insert Block diagram for LQR PI simulation}
\begin{figure}[!htbp]
    \centering
    \includegraphics[width=.8\textwidth,keepaspectratio=true]{figs/img/LQR_Simulink_Sim}
    \caption{Block Diagram for LQR Simulation.}
    \label{fig:LQR_Sim_Block_Diagram}
\end{figure}
%\todo[inline]{Insert results for LQR PI simulation}
\begin{figure}[!htbp]
    \centering
    \subfigure[][]{
    \includegraphics[width=.46\textwidth,keepaspectratio=true]{figs/matlab/LQR/PI_Sim/Pitch_LQR_Sim.eps}
    \label{fig:Pitch_LQR_Sim}
    }
    \subfigure[][]{
    \includegraphics[width=.46\textwidth,keepaspectratio=true]{figs/matlab/LQR/PI_Sim/Yaw_LQR_Sim.eps}
    \label{fig:Yaw_LQR_Sim}
    }    
    \subfigure[][]{
    \includegraphics[width=.46\textwidth,keepaspectratio=true]{figs/matlab/LQR/PI_Sim/Pitch_Volt_LQR_Sim.eps}
    \label{fig:Pitch_Volt_LQR_Sim}
    }    
    \subfigure[][]{
    \includegraphics[width=.46\textwidth,keepaspectratio=true]{figs/matlab/LQR/PI_Sim/Yaw_Volt_LQR_Sim.eps}
    \label{fig:Yaw_Volt_LQR_Sim}
    }
    \caption{Simulations for proportional and integral gain calculated by LQR.}
\end{figure}
As expected, as time goes to infinity, the error becomes zero.  A dip in Figure~\ref{fig:Pitch_LQG_Sim} can be seen as a result of the voltage decreasing in Figure~\ref{fig:Yaw_Volt_LQG_Sim} so that the yaw configuration in Figure~\ref{fig:Yaw_LQG_Sim} can converge on the desired orientation.

%----------------------------------------------------------------------
\section{LQG (PI Controller)}
%----------------------------------------------------------------------
The LQG block diagram required some minor changes including the use a kalman filter as seen in Figure~\ref{fig:LQG_Sim_Block_Diagram}.
%\todo[inline]{Insert Block diagram for LQG PI simulation}
\begin{figure}[!htbp]
    \centering
    \includegraphics[width=.8\textwidth,keepaspectratio=true]{figs/img/LQG_Simulink}
    \caption{Block Diagram for LQG Simulation.}
    \label{fig:LQG_Sim_Block_Diagram}
\end{figure}
%\todo[inline]{Insert results for LQG PI simulation}
\begin{figure}[!htbp]
    \centering
    \subfigure[][]{
    \includegraphics[width=.46\textwidth,keepaspectratio=true]{figs/matlab/LQG/LQG_Sim/Pitch_LQG_Sim.eps}
    \label{fig:Pitch_LQG_Sim}
    }
    \subfigure[][]{
    \includegraphics[width=.46\textwidth,keepaspectratio=true]{figs/matlab/LQG/LQG_Sim/Yaw_LQG_Sim.eps}
    \label{fig:Yaw_LQG_Sim}
    }    
    \subfigure[][]{
    \includegraphics[width=.46\textwidth,keepaspectratio=true]{figs/matlab/LQG/LQG_Sim/Pitch_Volt_LQG_Sim.eps}
    \label{fig:Pitch_Volt_LQG_Sim}
    }    
    \subfigure[][]{
    \includegraphics[width=.46\textwidth,keepaspectratio=true]{figs/matlab/LQG/LQG_Sim/Yaw_Volt_LQG_Sim.eps}
    \label{fig:Yaw_Volt_LQG_Sim}
    }
    \caption{Simulations for proportional and integral gain calculated by LQG.}
\end{figure}
The kalman had a larger effect on the system than we were expecting.  The position in Figure~\ref{fig:Pitch_LQG_Sim} and  Figure~\ref{fig:Yaw_LQG_Sim} had a much slower rise time.  The simulated voltage in  Figure~\ref{fig:Pitch_Volt_LQG_Sim} and  Figure~\ref{fig:Yaw_Volt_LQG_Sim} also rose much more slowly than LQR.  This means that the system is using less energy to reach the desired configuration. 
%%----------------------------------------------------------------------
%\section{Conclusions}
%%----------------------------------------------------------------------

%Note: constant used pitch XXXX degrees, yaw XXXX degrees\\
%Note: square used pitch XXXX degrees with period of XXXX, yaw XXXX degrees with period of XXXX\\
%Note: sine used pitch XXXX degrees with period of XXXX, yaw XXXX degrees with period of XXXX\\
%\begin{table}[!htbp]
%    \centering
%    \begin{tabular}{l|l|l|l|l|l|l}
%        \toprule
%        \textbf{} & \textbf{LQR(P)} & \textbf{LQR(PI)} & \textbf{LQG(PI)} \\
%        \toprule
%        RMSE Pitch Step & ? & ? & ?  \\
%        RMSE Yaw Step & ? & ? & ? \\
%        RMSE Pitch Square & ? & ? & ? \\
%        RMSE Yaw Square & ? & ? & ? \\
%        RMSE Pitch Sine & ? & ? & ? \\
%        RMSE Yaw Sine & ? & ? & ? \\
%        \bottomrule
%    \end{tabular}
%    \caption{Error Comparison for Simulated Algorithms}
%    \label{tab:Simulate_RMSE}
%\end{table}
%Based on the results XXXX preformed better in the simulations.
%----------------------------------------------------------------------



%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../finalReport"
%%% End:
